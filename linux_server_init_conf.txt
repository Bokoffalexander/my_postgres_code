Выполним первоначальную настройку сервера с целью повышения степени защищенности системы. Все действия, описанные в данной статье, выполняются с правами суперпользователя root.
Актуализируем информацию о доступных пакетах в используемых репозиториях:
apt update
С точки зрения безопасности заходить на сервер сразу пользователем root неправильно, поэтому создаем непривилегированного пользователя с именем san:
adduser san
В ходе интерактивного диалога необходимо задать пароль (New password), подтвердить его (Retype new password). Другие пункты заполнять не обязательно, можно проигнорировать их, нажимая ENTER. В финальном вопросе Is the information correct? [Y/n] нажимаем Y, затем ENTER.
Добавляем пользователя fwuser в группу sudo для возможности использования повышенных прав в системе:
usermod -aG sudo san
Редактируем конфигурационный файл SSH-сервера:
nano /etc/ssh/sshd_config
Рекомендуется сменить стандартный номер порта, допустим на 22200. Находим строку #Port 22 и приводим ее к виду:
Port 22200
Запретим входить напрямую пользователем root. Ищем строку PermitRootLogin yes, меняем значение на no, в итоге строка выглядит так:
PermitRootLogin no
Нажимаем комбинацию клавиш Ctrl+O, внизу отобразится строка: File Name to Write: /etc/ssh/sshd_config, подтверждаем нажатием ENTER. Изменения сохранены, теперь выходим из редактора нажатием сочетания клавиш Ctrl+X.
Для вступления в силу изменений конфигурации SSH-сервера перезапускаем его:
service sshd restart
Важно заметить, что при следующем подключении к серверу, подключаться нужно к порту 22200. Вход пользователю root запрещен. Авторизоваться необходимо вновь созданным пользователем fwuser, и только после успешного входа, следует повысить уровень привилегий в системе командой:
sudo su
Система попросит ввести свой пароль (не root) и нажать ENTER, если следующая строка начинается на root, а заканчивается знаком # — привилегии суперпользователя получены успешно.

************

ssh root@197.87.87.95

apt update

adduser san

usermod -aG sudo san

nano /etc/ssh/sshd_config

Port 22200

PermitRootLogin no

service sshd restart

ssh san@197.87.87.95 -P 22200

sudo su
